/*
 * Vorton - Highway Encounter SDL Remake Game.
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
#include "vorton.h"

static unsigned char x_value[720]={
	0xE0, 0xDF, 0xDF, 0xDF, 0xDF, 0xDE, 0xDE, 0xDD, 
	0xDD, 0xDC, 0xDB, 0xDB, 0xDA, 0xD9, 0xD8, 0xD6, 
	0xD5, 0xD4, 0xD3, 0xD1, 0xD0, 0xCE, 0xCD, 0xCB, 
	0xC9, 0xC8, 0xC6, 0xC4, 0xC2, 0xC0, 0xBE, 0xBC, 
	0xBA, 0xB8, 0xB6, 0xB4, 0xB2, 0xB0, 0xAE, 0xAC, 
	0xAA, 0xA8, 0xA6, 0xA4, 0xA2, 0x9F, 0x9D, 0x9B, 
	0x99, 0x97, 0x95, 0x93, 0x92, 0x90, 0x8E, 0x8C, 
	0x8A, 0x89, 0x87, 0x85, 0x84, 0x82, 0x81, 0x7F, 
	0x7E, 0x7D, 0x7C, 0x7A, 0x79, 0x78, 0x77, 0x76, 
	0x76, 0x75, 0x74, 0x74, 0x73, 0x72, 0x72, 0x72, 
	0x71, 0x71, 0x71, 0x71, 0x71, 0x71, 0x71, 0x71, 
	0x72, 0x72, 0x72, 0x73, 0x73, 0x74, 0x74, 0x75, 
	0x76, 0x76, 0x77, 0x78, 0x79, 0x7A, 0x7B, 0x7C, 
	0x7D, 0x7E, 0x7F, 0x80, 0x81, 0x82, 0x83, 0x85, 
	0x86, 0x87, 0x88, 0x89, 0x8B, 0x8C, 0x8D, 0x8E, 
	0x90, 0x91, 0x92, 0x93, 0x94, 0x95, 0x97, 0x98, 
	0x99, 0x9A, 0x9B, 0x9C, 0x9D, 0x9E, 0x9F, 0x9F, 
	0xA0, 0xA1, 0xA2, 0xA3, 0xA3, 0xA4, 0xA5, 0xA5, 
	0xA6, 0xA6, 0xA7, 0xA7, 0xA7, 0xA8, 0xA8, 0xA8, 
	0xA8, 0xA8, 0xA8, 0xA8, 0xA8, 0xA8, 0xA8, 0xA8, 
	0xA8, 0xA8, 0xA8, 0xA7, 0xA7, 0xA7, 0xA6, 0xA6, 
	0xA6, 0xA5, 0xA5, 0xA4, 0xA4, 0xA3, 0xA3, 0xA2, 
	0xA2, 0xA1, 0xA1, 0xA0, 0xA0, 0x9F, 0x9E, 0x9E, 
	0x9D, 0x9D, 0x9C, 0x9C, 0x9B, 0x9B, 0x9A, 0x9A, 
	0x99, 0x99, 0x99, 0x98, 0x98, 0x98, 0x97, 0x97, 
	0x97, 0x97, 0x97, 0x97, 0x97, 0x97, 0x97, 0x97, 
	0x97, 0x97, 0x97, 0x97, 0x98, 0x98, 0x98, 0x99, 
	0x99, 0x9A, 0x9A, 0x9B, 0x9C, 0x9C, 0x9D, 0x9E, 
	0x9F, 0x9F, 0xA0, 0xA1, 0xA2, 0xA3, 0xA4, 0xA5, 
	0xA6, 0xA7, 0xA8, 0xAA, 0xAB, 0xAC, 0xAD, 0xAE, 
	0xAF, 0xB1, 0xB2, 0xB3, 0xB4, 0xB6, 0xB7, 0xB8, 
	0xB9, 0xBA, 0xBC, 0xBD, 0xBE, 0xBF, 0xC0, 0xC1, 
	0xC2, 0xC3, 0xC4, 0xC5, 0xC6, 0xC7, 0xC8, 0xC9, 
	0xC9, 0xCA, 0xCB, 0xCB, 0xCC, 0xCC, 0xCD, 0xCD, 
	0xCD, 0xCE, 0xCE, 0xCE, 0xCE, 0xCE, 0xCE, 0xCE, 
	0xCE, 0xCD, 0xCD, 0xCD, 0xCC, 0xCB, 0xCB, 0xCA, 
	0xC9, 0xC9, 0xC8, 0xC7, 0xC6, 0xC5, 0xC3, 0xC2, 
	0xC1, 0xC0, 0xBE, 0xBD, 0xBB, 0xBA, 0xB8, 0xB6, 
	0xB5, 0xB3, 0xB1, 0xAF, 0xAD, 0xAC, 0xAA, 0xA8, 
	0xA6, 0xA4, 0xA2, 0xA0, 0x9D, 0x9B, 0x99, 0x97, 
	0x95, 0x93, 0x91, 0x8F, 0x8D, 0x8B, 0x89, 0x87, 
	0x85, 0x83, 0x81, 0x7F, 0x7D, 0x7B, 0x79, 0x77, 
	0x76, 0x74, 0x72, 0x71, 0x6F, 0x6E, 0x6C, 0x6B, 
	0x6A, 0x69, 0x67, 0x66, 0x65, 0x64, 0x64, 0x63, 
	0x62, 0x62, 0x61, 0x61, 0x60, 0x60, 0x60, 0x60, 
	0x60, 0x60, 0x60, 0x60, 0x60, 0x61, 0x61, 0x62, 
	0x62, 0x63, 0x64, 0x64, 0x65, 0x66, 0x67, 0x69, 
	0x6A, 0x6B, 0x6C, 0x6E, 0x6F, 0x71, 0x72, 0x74, 
	0x76, 0x77, 0x79, 0x7B, 0x7D, 0x7F, 0x81, 0x83, 
	0x85, 0x87, 0x89, 0x8B, 0x8D, 0x8F, 0x91, 0x93, 
	0x95, 0x97, 0x99, 0x9B, 0x9D, 0x9F, 0xA2, 0xA4, 
	0xA6, 0xA8, 0xAA, 0xAC, 0xAD, 0xAF, 0xB1, 0xB3, 
	0xB5, 0xB6, 0xB8, 0xBA, 0xBB, 0xBD, 0xBE, 0xC0, 
	0xC1, 0xC2, 0xC3, 0xC5, 0xC6, 0xC7, 0xC8, 0xC9, 
	0xC9, 0xCA, 0xCB, 0xCB, 0xCC, 0xCD, 0xCD, 0xCD, 
	0xCE, 0xCE, 0xCE, 0xCE, 0xCE, 0xCE, 0xCE, 0xCE, 
	0xCD, 0xCD, 0xCD, 0xCC, 0xCC, 0xCB, 0xCB, 0xCA, 
	0xC9, 0xC9, 0xC8, 0xC7, 0xC6, 0xC5, 0xC4, 0xC3, 
	0xC2, 0xC1, 0xC0, 0xBF, 0xBE, 0xBD, 0xBC, 0xBA, 
	0xB9, 0xB8, 0xB7, 0xB6, 0xB4, 0xB3, 0xB2, 0xB1, 
	0xB0, 0xAE, 0xAD, 0xAC, 0xAB, 0xAA, 0xA8, 0xA7, 
	0xA6, 0xA5, 0xA4, 0xA3, 0xA2, 0xA1, 0xA0, 0xA0, 
	0x9F, 0x9E, 0x9D, 0x9C, 0x9C, 0x9B, 0x9A, 0x9A, 
	0x99, 0x99, 0x98, 0x98, 0x98, 0x97, 0x97, 0x97, 
	0x97, 0x97, 0x97, 0x97, 0x97, 0x97, 0x97, 0x97, 
	0x97, 0x97, 0x97, 0x98, 0x98, 0x98, 0x99, 0x99, 
	0x99, 0x9A, 0x9A, 0x9B, 0x9B, 0x9C, 0x9C, 0x9D, 
	0x9D, 0x9E, 0x9E, 0x9F, 0x9F, 0xA0, 0xA1, 0xA1, 
	0xA2, 0xA2, 0xA3, 0xA3, 0xA4, 0xA4, 0xA5, 0xA5, 
	0xA6, 0xA6, 0xA6, 0xA7, 0xA7, 0xA7, 0xA8, 0xA8, 
	0xA8, 0xA8, 0xA8, 0xA8, 0xA8, 0xA8, 0xA8, 0xA8, 
	0xA8, 0xA8, 0xA8, 0xA8, 0xA7, 0xA7, 0xA7, 0xA6, 
	0xA6, 0xA5, 0xA5, 0xA4, 0xA3, 0xA3, 0xA2, 0xA1, 
	0xA0, 0x9F, 0x9F, 0x9E, 0x9D, 0x9C, 0x9B, 0x9A, 
	0x99, 0x98, 0x97, 0x95, 0x94, 0x93, 0x92, 0x91, 
	0x8F, 0x8E, 0x8D, 0x8C, 0x8B, 0x89, 0x88, 0x87, 
	0x86, 0x85, 0x83, 0x82, 0x81, 0x80, 0x7F, 0x7E, 
	0x7D, 0x7C, 0x7B, 0x7A, 0x79, 0x78, 0x77, 0x76, 
	0x76, 0x75, 0x74, 0x74, 0x73, 0x73, 0x72, 0x72, 
	0x72, 0x71, 0x71, 0x71, 0x71, 0x71, 0x71, 0x71, 
	0x71, 0x72, 0x72, 0x72, 0x73, 0x74, 0x74, 0x75, 
	0x76, 0x76, 0x77, 0x78, 0x79, 0x7A, 0x7C, 0x7D, 
	0x7E, 0x7F, 0x81, 0x82, 0x84, 0x85, 0x87, 0x89, 
	0x8A, 0x8C, 0x8E, 0x90, 0x92, 0x93, 0x95, 0x97, 
	0x99, 0x9B, 0x9D, 0xA0, 0xA2, 0xA4, 0xA6, 0xA8, 
	0xAA, 0xAC, 0xAE, 0xB0, 0xB2, 0xB4, 0xB6, 0xB8, 
	0xBA, 0xBC, 0xBE, 0xC0, 0xC2, 0xC4, 0xC6, 0xC8, 
	0xC9, 0xCB, 0xCD, 0xCE, 0xD0, 0xD1, 0xD3, 0xD4, 
	0xD5, 0xD6, 0xD8, 0xD9, 0xDA, 0xDB, 0xDB, 0xDC, 
	0xDD, 0xDD, 0xDE, 0xDE, 0xDF, 0xDF, 0xDF, 0xDF
};

static unsigned char y_value[720]={
	0x78, 0x7A, 0x7C, 0x7E, 0x80, 0x83, 0x85, 0x87, 
	0x89, 0x8B, 0x8D, 0x8F, 0x91, 0x93, 0x95, 0x97, 
	0x99, 0x9B, 0x9D, 0x9E, 0xA0, 0xA2, 0xA3, 0xA5, 
	0xA6, 0xA7, 0xA9, 0xAA, 0xAB, 0xAC, 0xAD, 0xAE, 
	0xAF, 0xB0, 0xB0, 0xB1, 0xB1, 0xB2, 0xB2, 0xB3, 
	0xB3, 0xB3, 0xB3, 0xB3, 0xB3, 0xB3, 0xB2, 0xB2, 
	0xB2, 0xB1, 0xB1, 0xB0, 0xAF, 0xAF, 0xAE, 0xAD, 
	0xAC, 0xAB, 0xAA, 0xA9, 0xA7, 0xA6, 0xA5, 0xA4, 
	0xA2, 0xA1, 0x9F, 0x9E, 0x9C, 0x9B, 0x99, 0x98, 
	0x96, 0x94, 0x93, 0x91, 0x8F, 0x8D, 0x8C, 0x8A, 
	0x88, 0x87, 0x85, 0x83, 0x81, 0x80, 0x7E, 0x7C, 
	0x7B, 0x79, 0x77, 0x76, 0x74, 0x73, 0x71, 0x70, 
	0x6F, 0x6D, 0x6C, 0x6B, 0x69, 0x68, 0x67, 0x66, 
	0x65, 0x64, 0x63, 0x62, 0x61, 0x61, 0x60, 0x5F, 
	0x5F, 0x5E, 0x5E, 0x5D, 0x5D, 0x5C, 0x5C, 0x5C, 
	0x5C, 0x5C, 0x5C, 0x5C, 0x5C, 0x5C, 0x5C, 0x5C, 
	0x5C, 0x5D, 0x5D, 0x5D, 0x5E, 0x5E, 0x5F, 0x5F, 
	0x60, 0x60, 0x61, 0x61, 0x62, 0x63, 0x63, 0x64, 
	0x65, 0x65, 0x66, 0x67, 0x68, 0x68, 0x69, 0x6A, 
	0x6B, 0x6B, 0x6C, 0x6D, 0x6E, 0x6E, 0x6F, 0x70, 
	0x70, 0x71, 0x72, 0x72, 0x73, 0x73, 0x74, 0x74, 
	0x75, 0x75, 0x76, 0x76, 0x76, 0x77, 0x77, 0x77, 
	0x77, 0x77, 0x77, 0x77, 0x78, 0x77, 0x77, 0x77, 
	0x77, 0x77, 0x77, 0x77, 0x76, 0x76, 0x76, 0x75, 
	0x75, 0x74, 0x74, 0x73, 0x73, 0x72, 0x72, 0x71, 
	0x70, 0x70, 0x6F, 0x6E, 0x6E, 0x6D, 0x6C, 0x6B, 
	0x6B, 0x6A, 0x69, 0x68, 0x68, 0x67, 0x66, 0x65, 
	0x65, 0x64, 0x63, 0x63, 0x62, 0x61, 0x61, 0x60, 
	0x60, 0x5F, 0x5F, 0x5E, 0x5E, 0x5D, 0x5D, 0x5D, 
	0x5C, 0x5C, 0x5C, 0x5C, 0x5C, 0x5C, 0x5C, 0x5C, 
	0x5C, 0x5C, 0x5C, 0x5C, 0x5D, 0x5D, 0x5E, 0x5E, 
	0x5F, 0x5F, 0x60, 0x61, 0x61, 0x62, 0x63, 0x64, 
	0x65, 0x66, 0x67, 0x68, 0x69, 0x6B, 0x6C, 0x6D, 
	0x6F, 0x70, 0x71, 0x73, 0x74, 0x76, 0x77, 0x79, 
	0x7B, 0x7C, 0x7E, 0x80, 0x81, 0x83, 0x85, 0x87, 
	0x88, 0x8A, 0x8C, 0x8D, 0x8F, 0x91, 0x93, 0x94, 
	0x96, 0x98, 0x99, 0x9B, 0x9C, 0x9E, 0x9F, 0xA1, 
	0xA2, 0xA4, 0xA5, 0xA6, 0xA7, 0xA9, 0xAA, 0xAB, 
	0xAC, 0xAD, 0xAE, 0xAF, 0xAF, 0xB0, 0xB1, 0xB1, 
	0xB2, 0xB2, 0xB2, 0xB3, 0xB3, 0xB3, 0xB3, 0xB3, 
	0xB3, 0xB3, 0xB2, 0xB2, 0xB1, 0xB1, 0xB0, 0xB0, 
	0xAF, 0xAE, 0xAD, 0xAC, 0xAB, 0xAA, 0xA9, 0xA7, 
	0xA6, 0xA5, 0xA3, 0xA2, 0xA0, 0x9E, 0x9D, 0x9B, 
	0x99, 0x97, 0x95, 0x93, 0x91, 0x8F, 0x8D, 0x8B, 
	0x89, 0x87, 0x85, 0x83, 0x80, 0x7E, 0x7C, 0x7A, 
	0x78, 0x75, 0x73, 0x71, 0x6F, 0x6C, 0x6A, 0x68, 
	0x66, 0x64, 0x62, 0x60, 0x5E, 0x5C, 0x5A, 0x58, 
	0x56, 0x54, 0x52, 0x51, 0x4F, 0x4D, 0x4C, 0x4A, 
	0x49, 0x48, 0x46, 0x45, 0x44, 0x43, 0x42, 0x41, 
	0x40, 0x3F, 0x3F, 0x3E, 0x3E, 0x3D, 0x3D, 0x3C, 
	0x3C, 0x3C, 0x3C, 0x3C, 0x3C, 0x3C, 0x3D, 0x3D, 
	0x3D, 0x3E, 0x3E, 0x3F, 0x40, 0x40, 0x41, 0x42, 
	0x43, 0x44, 0x45, 0x46, 0x47, 0x49, 0x4A, 0x4B, 
	0x4D, 0x4E, 0x50, 0x51, 0x53, 0x54, 0x56, 0x57, 
	0x59, 0x5B, 0x5C, 0x5E, 0x60, 0x62, 0x63, 0x65, 
	0x67, 0x68, 0x6A, 0x6C, 0x6E, 0x6F, 0x71, 0x73, 
	0x74, 0x76, 0x77, 0x79, 0x7B, 0x7C, 0x7E, 0x7F, 
	0x80, 0x82, 0x83, 0x84, 0x86, 0x87, 0x88, 0x89, 
	0x8A, 0x8B, 0x8C, 0x8D, 0x8E, 0x8E, 0x8F, 0x90, 
	0x90, 0x91, 0x91, 0x92, 0x92, 0x93, 0x93, 0x93, 
	0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 
	0x93, 0x92, 0x92, 0x92, 0x91, 0x91, 0x90, 0x90, 
	0x8F, 0x8F, 0x8E, 0x8E, 0x8D, 0x8C, 0x8C, 0x8B, 
	0x8A, 0x8A, 0x89, 0x88, 0x87, 0x87, 0x86, 0x85, 
	0x84, 0x84, 0x83, 0x82, 0x81, 0x81, 0x80, 0x7F, 
	0x7F, 0x7E, 0x7D, 0x7D, 0x7C, 0x7C, 0x7B, 0x7B, 
	0x7A, 0x7A, 0x79, 0x79, 0x79, 0x78, 0x78, 0x78, 
	0x78, 0x78, 0x78, 0x78, 0x78, 0x78, 0x78, 0x78, 
	0x78, 0x78, 0x78, 0x78, 0x79, 0x79, 0x79, 0x7A, 
	0x7A, 0x7B, 0x7B, 0x7C, 0x7C, 0x7D, 0x7D, 0x7E, 
	0x7F, 0x7F, 0x80, 0x81, 0x81, 0x82, 0x83, 0x84, 
	0x84, 0x85, 0x86, 0x87, 0x87, 0x88, 0x89, 0x8A, 
	0x8A, 0x8B, 0x8C, 0x8C, 0x8D, 0x8E, 0x8E, 0x8F, 
	0x8F, 0x90, 0x90, 0x91, 0x91, 0x92, 0x92, 0x92, 
	0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 
	0x93, 0x93, 0x93, 0x93, 0x92, 0x92, 0x91, 0x91, 
	0x90, 0x90, 0x8F, 0x8E, 0x8E, 0x8D, 0x8C, 0x8B, 
	0x8A, 0x89, 0x88, 0x87, 0x86, 0x84, 0x83, 0x82, 
	0x80, 0x7F, 0x7E, 0x7C, 0x7B, 0x79, 0x77, 0x76, 
	0x74, 0x73, 0x71, 0x6F, 0x6E, 0x6C, 0x6A, 0x68, 
	0x67, 0x65, 0x63, 0x62, 0x60, 0x5E, 0x5C, 0x5B, 
	0x59, 0x57, 0x56, 0x54, 0x53, 0x51, 0x50, 0x4E, 
	0x4D, 0x4B, 0x4A, 0x49, 0x47, 0x46, 0x45, 0x44, 
	0x43, 0x42, 0x41, 0x40, 0x40, 0x3F, 0x3E, 0x3E, 
	0x3D, 0x3D, 0x3D, 0x3C, 0x3C, 0x3C, 0x3C, 0x3C, 
	0x3C, 0x3C, 0x3D, 0x3D, 0x3E, 0x3E, 0x3F, 0x3F, 
	0x40, 0x41, 0x42, 0x43, 0x44, 0x45, 0x46, 0x48, 
	0x49, 0x4A, 0x4C, 0x4D, 0x4F, 0x51, 0x52, 0x54, 
	0x56, 0x58, 0x5A, 0x5C, 0x5E, 0x60, 0x62, 0x64, 
	0x66, 0x68, 0x6A, 0x6C, 0x6F, 0x71, 0x73, 0x75
};


static unsigned char x_value_back[8]={
	0xE0, 0xDF, 0xDF, 0xDF, 0xDF, 0xDE, 0xDE, 0xDD
};
static unsigned char y_value_back[8]={
	0x78, 0x7A, 0x7C, 0x7E, 0x80, 0x83, 0x85, 0x87
};

static inline int WaitKey(int *option)
{
	int ret=0, pushup=0, pushdown=0, hat=0;
	SDL_Event event;
	
            /* Poll for events */
            while( SDL_PollEvent( &event ) ){/*0*/
                
                switch( event.type ){ /*1*/
#ifndef GP32
		    case SDL_JOYHATMOTION:
#ifdef DREAMCAST
			    	hat=15^SDL_JoystickGetHat(joy,event.jhat.hat);
#else
			    	hat=SDL_JoystickGetHat(joy,event.jhat.hat);
#endif
				if (hat & SDL_HAT_UP)
					pushup=1;
				else if (hat & SDL_HAT_DOWN)
						pushdown=1;
			    	break;
                  
		    case SDL_JOYBUTTONUP:
		    		ret=1;
				break;
#endif
                    case SDL_KEYUP:
			    switch(event.key.keysym.sym)
			    {
				    case SDLK_RETURN:
					    ret=1;
					    break;
				    case SDLK_UP:
					    pushup=1;
					    break;
				    case SDLK_DOWN:
					    pushdown=1;
					    break;
			    }
			    break;
		    case SDL_QUIT:
                        ret = 1;
                        break;

                    default:
                        break;
                } /*1*/

            } /*0*/

	  if (pushup)
	  {
		play_sound(SND_PING);
		if (*option)
			*option=(*option)-1;
		else
			*option=4;
	  }
	  else if (pushdown)
	  	{
			play_sound(SND_PING);
			*option=((*option)+1)%5;
	 	}
	  return ret;
}	



static inline void draw_ball(int x, int y)
{
	SDL_Rect mov;
	SDL_Surface *s=image[IMG_BALL];

	mov.x=x;
	mov.y=y;
	mov.w=s->w;
	mov.h=s->h;
	SDL_BlitSurface(s, NULL, screen, &mov);
}

static inline void real_draw_balls(int x, int y)
{
	draw_ball(x,y);
	x=320-x;
	draw_ball(x,y);
	y=240-y;
	draw_ball(x,y);
	x=320-x;
	draw_ball(x,y);
}

static inline void draw_balls(int x, int y)
{
	static int cont=0;
	int i;

	real_draw_balls(x_value_back[7], y_value_back[7]);
	real_draw_balls(x_value_back[5], y_value_back[5]);
	real_draw_balls(x_value_back[3], y_value_back[3]);
	real_draw_balls(x_value_back[1], y_value_back[1]);

	real_draw_balls(x,y);
	
	for(i=7;i>0;i--)
	{
		x_value_back[i]=x_value_back[i-1];
		y_value_back[i]=y_value_back[i-1];
	}

	x_value_back[0]=x;
	y_value_back[0]=y;
	cont++;
}

static char *option_text[5]={"Nuevo Juego", "Continuar Juego", "Idioma", "Tabla de Records", "Salir" };

#define OPTION_NEW 0
#define OPTION_CONTINUE 1
#define OPTION_RECORDS 2
#define OPTION_LANG 3
#define OPTION_EXIT 4

#define OPTION_CUT_NEW 58
#define OPTION_CUT_CONTINUE 90
#define OPTION_CUT_RECORDS 122
#define OPTION_CUT_LANG 154
#define OPTION_CUT_EXIT 186

static inline void draw_option(int n, int n2)
{
	font_opt_centered(screen,n2,option_text[n]);
}

static inline void draw_options(int option)
{
	static int cont=0;
	static int blink=0;

	switch(option)
	{
		case 0:
			if (blink)
				draw_option(OPTION_NEW,OPTION_CUT_NEW);
			draw_option(OPTION_CONTINUE,OPTION_CUT_CONTINUE);
			draw_option(OPTION_RECORDS,OPTION_CUT_RECORDS);
			draw_option(OPTION_LANG,OPTION_CUT_LANG);
			draw_option(OPTION_EXIT,OPTION_CUT_EXIT);
			break;
		case 1:
			draw_option(OPTION_NEW,OPTION_CUT_NEW);
			if (blink)
				draw_option(OPTION_CONTINUE,OPTION_CUT_CONTINUE);
			draw_option(OPTION_RECORDS,OPTION_CUT_RECORDS);
			draw_option(OPTION_LANG,OPTION_CUT_LANG);
			draw_option(OPTION_EXIT,OPTION_CUT_EXIT);
			break;
		case 2:
			draw_option(OPTION_NEW,OPTION_CUT_NEW);
			draw_option(OPTION_CONTINUE,OPTION_CUT_CONTINUE);
			if (blink)
				draw_option(OPTION_RECORDS,OPTION_CUT_RECORDS);
			draw_option(OPTION_LANG,OPTION_CUT_LANG);
			draw_option(OPTION_EXIT,OPTION_CUT_EXIT);
			break;
		case 3:
			draw_option(OPTION_NEW,OPTION_CUT_NEW);
			draw_option(OPTION_CONTINUE,OPTION_CUT_CONTINUE);
			draw_option(OPTION_RECORDS,OPTION_CUT_RECORDS);
			if (blink)
				draw_option(OPTION_LANG,OPTION_CUT_LANG);
			draw_option(OPTION_EXIT,OPTION_CUT_EXIT);
			break;
		default:
			draw_option(OPTION_NEW,OPTION_CUT_NEW);
			draw_option(OPTION_CONTINUE,OPTION_CUT_CONTINUE);
			draw_option(OPTION_RECORDS,OPTION_CUT_RECORDS);
			draw_option(OPTION_LANG,OPTION_CUT_LANG);
			if (blink)
				draw_option(OPTION_EXIT,OPTION_CUT_EXIT);
	}

	cont++;
	if (!(cont%16))
		blink^=-1;
}


int selection(int mus)
{
	int option=0;
	int i=3, vel=4, spin=1, spin_offset=1;
	int x,y;
	int offset=0;
	int x2,y2;

	if (!mus)
		music_play(MUSIC_MENU);
	x2=screen->w/2;
	y2=screen->h/2;
	for(x=1;x<=x2;x+=8)
	{
		SDL_Rect r;
		r.x=x2-x;
		r.y=y2-x;
		r.w=x<<1;
		r.h=r.w;
		SDL_BlitSurface(image[IMG_MENU], &r, screen, &r);
		SDL_Flip(screen);
		SDL_Delay(10);
	}

	while(!WaitKey(&option))
	{
		SDL_BlitSurface(image[IMG_MENU], NULL, screen, NULL);
		x=x_value[i];
		y=y_value[i]+offset;
		draw_balls(x,y);
		
		i+=vel;
		if (i>=720)
		{
			i=0;
			if (spin)
			{
				vel--;
				if (vel==2)
					spin=0;
			}
			else
			{
				vel++;
				if (vel>5)
					spin=1;
			}
			if (spin_offset)
			{
				offset+=16;
				if (offset>=64)
					spin_offset=0;
			}
			else
			{
				offset-=16;
				if (offset<=-64)
					spin_offset=1;
			}
		}

		draw_options(option);
		SDL_Flip(screen);
#ifndef GP32
#ifdef DREAMCAST
		SDL_Delay(10);
#else
		SDL_Delay(20);
#endif
#endif

	}
	do
		SDL_Delay(100);
	while(WaitKey(&x));
	return option;
}

